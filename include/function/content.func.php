<?php/**	All function of content file***/function get_the_post($post_id,$name){	global $prefix_contents ;				$result = borno_query("SELECT * FROM $prefix_contents WHERE id='".mysqli_escape($post_id)."'");				$count = mysqli_num_rows($result);//counting			if($count==1){						$row = mysqli_fetch_array($result);									$datas = $row[$name];									//$datas = ($datas);//*						if($name=='title'){							$datas = ($datas);						}												//shortcode function							if($name == 'content'){																																		/*					*	Working with shortcode					*					*/					global $shortcoder;																				if(is_array($shortcoder)){						foreach ($shortcoder as $shortcode){																				$scode = $shortcode->shortcode_name;							$sput = $shortcode->output;							$datas = str_replace('{'.$scode.'}',$sput,$datas);													}					}														/*					*	Working with freeway shortcoder					*					*/											global $freewayshortcodeshortcoder ;												if(is_array($freewayshortcodeshortcoder)){													foreach ($freewayshortcodeshortcoder as $fshortcode){																							$scode = $fshortcode->shortcode_name;																$sput = $fshortcode->output;																$datas = str_replace($scode,$sput,$datas);															}						}																	}			return $datas ; // return with data				}	else if(0==$count){		return  false; 			}	else {				return false;			}}/*******/function is_exists_content($post_id){	global $prefix_contents;		$result = borno_query("SELECT id FROM $prefix_contents WHERE id='".mysqli_escape($post_id)."'");		$count = mysqli_num_rows($result);		if($count==1){			return true;			}	else{		return false;		}}/*******/function previous_post_link($current_id){global $prefix_content;$query= borno_query("SELECT id FROM $prefix_content WHERE id<$current_id and post_status='publish' and post_level = 'public' ORDER BY `id` DESC "); $count = mysqli_num_rows($query);	if(!$count==0){		$row = mysqli_fetch_array($query);		return the_post_link($row['id']);;	}	else{		return false;	}	}/*******/function next_post_link($current_id){global $prefix_content;$query= borno_query("SELECT id FROM $prefix_content WHERE id>$current_id and post_status='publish' and post_level = 'public' ORDER BY `id`  ASC  "); $count = mysqli_num_rows($query);	if(!$count==0){		$row = mysqli_fetch_array($query);		return the_post_link($row['id']);	}	else{		return false;	}	}/*******/function the_post_link($post_id,$a=true){			if(link_type()=='dynamic'){ // link_type()=== get_the_option('site_permalink')		$trimed = trim(content_permalink($post_id));		if(content_permalink($post_id) && !empty($trimed)){			if($a){				return "<a href='".get_the_option('site_address').'/p/'.content_permalink($post_id)."'>".get_the_post($post_id,'title')."</a>";			}			else{				return get_the_option('site_address').'/p/'.content_permalink($post_id);			}		}else{			if($a){				return "<a href='".get_the_option('site_address').'/id/'.get_the_post($post_id,'id')."'>".get_the_post($post_id,'title')."</a>";			}			else{				return get_the_option('site_address').'/id/'.get_the_post($post_id,'id');			}				}	}			else{		if($a){		return "<a href='".get_the_option('site_address').'/?p='.get_the_post($post_id,'id')."'>".get_the_post($post_id,'title')."</a>";		}		else{		return get_the_option('site_address').'/?p='.get_the_post($post_id,'id');		}	}}/*******/function date_of_post($post_id,$formet){ return date($formet, strtotime(get_the_post($post_id,'times').get_the_option('timelplus')." hour"));}/*******/function post_excerpt($content,$url,$readmore) {$num  = 50 ;// those first letter one to display First$limit = $num+1;$excerpt = explode(' ', $content, $limit);array_pop($excerpt);$excerpt = strip_tags(implode(" ",$excerpt))."....";if($readmore==1){$button = "<br><a href='".get_the_option('site_address')."/?p=".$url."' class='btn btn-info btn-mini'>Read More</a>";}else{$button='';}$data = $excerpt.$button;return $data;}/*******/function the_excerpt($content,$num) {if($num>strlen($content)){	return $content;}// those first letter one to display First$limit = $num+1;$excerpt = explode(' ', $content, $limit);array_pop($excerpt);$excerpt = strip_tags(implode(" ",$excerpt))."....";$data = $excerpt;return $data;}/*******/function content_edit_link($id, $site_address,$current_user){	if(filter_var($id, FILTER_VALIDATE_INT)){		global $prefix_content;				$query = borno_query("SELECT * FROM $prefix_content WHERE id='$id'");				if(mysqli_num_rows($query)==1){			$row = mysqli_fetch_array($query);			if(user_can('edit_all_post')){				$link = "<a href='".admin_url()."/?pages=editor&edit_id=".$row['id']."'>Edit This</a>";				return $link;			}			else if(user_can('edit_own_post')){				if($row['user_id']==$current_user){				$link = "<a href='".admin_url()."/?pages=editor&edit_id=".$row['id']."'>Edit This</a>";				return $link;				}				else{				return false;				}			}			else{				return false;			}					}		else{					return false;		}	}	else{		return false;		}}/*******/function content_check($id){	$int_options = array("options"=>array("min_range"=>1));	if(!filter_var($id, FILTER_VALIDATE_INT, $int_options)){		//if the post id is not and INT		return false;	}	else if(!is_exists_content($id)){		return false;	}	//check the database , if exists post	else if( get_the_post($id,'id')=='0'){		// if the result not equel to  1 than die();		return false;	}	else{			if( get_the_post($id,'post_status')=='trash'){		// if the result not equel to  1 than die();			return false;		}		else{			//check user permission			if(!user_logged_in()){					if(get_the_post($id,'post_status')=='publish'){											if(get_the_post($id,'post_level')=='public'){							return true;						}						else if(get_the_post($id,'post_level')=='loginuser'){							return true;						}						else{							return false;///						}											}					else{						return false;					}								}			else{				$user_id = loginuserinfo('id');				if(get_the_post($id,'user_id')==$user_id){									return true;												}				else{					if(get_the_post($id,'post_status')=='publish'){											if(get_the_post($id,'post_level')=='public'){													return true;						}						else if(get_the_post($id,'post_level')=='loginuser'){							return true;						}												else{							return false;						}					}					else{						return false;										}													}									}					}	}}/*******/function post_content($post_id){	global $post_password ;    $post_passwords =get_the_post($post_id,'post_password');/***@Check post privacy*****///if the post level is publicif( get_the_post($post_id,'post_level') == 'public'){	//if password not found    $post_passwords =get_the_post($post_id,'post_password');	if($post_passwords=="" or $post_passwords=="  " or $post_passwords==" " or empty($post_passwords) or trim($post_passwords)==''){	//thanreturnecho the content		return get_the_post($post_id,'content');	}	//if get password	else{		//if isset [POST] password than check the password		if(!empty($post_password)){			//if password match			if($post_password===get_the_post($post_id,'post_password')){				//than echo content				return get_the_post($post_id,'content');			}			//else if password not match			else{				return '<br>Please Enter an correct password<br>'. // password not match message				 '<form method="post" class="post_unlock" action="">'.				 '<input type="text" placeholder="Password" name="post_password" /><br>'.				 '<input type="submit" class="btn" value="Submit" />'.				 '</form><br>';			}		}		//if not isset[POST] password  than display a password form 		else{			return '<br><form method="post" class="post_unlock" action="">'.			 '<input type="text" placeholder="Password" name="post_password" /><br>'.			 '<input type="submit"  class="btn" Value="Submit" />'.			 '</form><br>';		}	}	}// if post level is not public(may be it private)else if(get_the_post($post_id,'post_level')  == 'private' or get_the_post($post_id,'post_status')  == 'draft') {	// if  user post user logged in , than echo the content	if(loginuserinfo('id')==the_post_user('id')){		return get_the_post($post_id,'content');	}	// else a simple message	else{		return 'You Can not view this page';	}}else if(get_the_post($post_id,'post_level')  == 'loginuser'){	if(!user_logged_in()){	//if user not logged in and the rule is to log in than login ..		$site_address = get_the_option('site_address');		$current_url = current_url();		return "You must be <a href='$site_address/sign-in.php?back=$current_url'>Login </a> to view the content of this page";					}	else{		if($post_passwords=="" or $post_passwords=="  " or $post_passwords==" " or empty($post_passwords) or trim($post_passwords)==''){	//than echo the content		return get_the_post($post_id,'content');	}	//if get password	else{		//if isset [POST] password than check the password		if(!empty($post_password)){			//if password match			if($post_password===get_the_post($post_id,'post_password')){				//than echo content				return get_the_post($post_id,'content');			}			//else if password not match			else{				return '<br>Please Enter an correct password<br>'. // password not match message				 '<form method="post" class="post_unlock" action="">'.				 '<input type="text" name="post_password" /><br>'.				 '<input type="submit" class="btn" value="Submit" />'.				 '</form><br>';			}		}		//if not isset[POST] password  than display a password form 		else{			return '<br><form method="post" class="post_unlock" action="">'.			 '<input type="text" name="post_password" /><br>'.			 '<input type="submit"  class="btn" value="Submit"/>'.			 '</form><br>';		}	}		}}//else echo the contentelse{	return get_the_post($post_id,'content');}}/*******/function the_post_cat($post_id){	if(filter_var($post_id, FILTER_VALIDATE_INT)){		if(content_check($post_id)){			global $prefix_catmeta;			$post_id= mysqli_escape($post_id);			$query = borno_query("SELECT * FROM $prefix_catmeta WHERE post_id='$post_id'");			$count = mysqli_num_rows($query);			if($count==1){				$row = mysqli_fetch_array($query);				$cat_id = $row['cat_id'];				if(is_exists_cat($cat_id)){					$cat = get_the_cat($cat_id,'name');										return "<a href='". the_cat_link($cat_id). "'>".$cat."</a>";														}				else{					borno_query("UPDATE $prefix_catmeta SET `cat_id` = '1' WHERE post_id =$post_id ");															return '<a href="'.the_cat_link(1).'">Uncategory</a>';														}			}			else{					return '<a href="'.the_cat_link(1).'">Uncategory</a>';				borno_query("INSERT INTO $prefix_catmeta (`post_id`, `cat_id`) VALUES ('$post_id', '1');");			}		}		else{			return false;		}			}	else{		return false;	}}function add_new_post($user_id ,$title , $content,$post_status,$level,$password,$comment_permission ,$browser_info, $ip,$edited,$the_cat,$cpermalink=''){		global $prefix_contents ;				/*		*	escaping string		*		*/		$title = mysqli_escape($title);		$title = htmlspecialchars($title);		$content = mysqli_escape($content);		$password = mysqli_escape($password);		$password= htmlspecialchars($password);						/*		*	Decide the new peramilijhnk		*		*/					/*			*	check the permalink is empty or not			*/						if(empty($cpermalink)){				$cpermalink  = 'random';			}else if(!validate_username($cpermalink)){				$cpermalink  = 'random';			}					$i=1;		$ppb = $cpermalink;		while(true){			if(!is_exists_cpermalink($cpermalink)){							break 1; 							}else{				$i++ ; 				$cpermalink = $ppb."_$i";						}		}				$cpermalink = mysqli_escape($cpermalink);		///we are successfullt ger $cpermalink																	//make a active key		$chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".	'0123456789``-=~!@#$%^&*()_+,./<>?;:[]{}\|oxyz';	   $active_key =  md5(substr(str_shuffle($chars),0,8));//active key         //add the content	borno_query("INSERT INTO $prefix_contents (`user_id`, `title`, `content`, `post_status`, `post_level`, `post_password`, `comment_permission`, `browser_info`, `ip`, `edited`,`active_key`) VALUES ( '$user_id', '$title', '$content', '$post_status','$level','$password', '$comment_permission', '$browser_info', '$ip','$edited','$active_key' )");		$row = mysqli_fetch_array(borno_query("SELECT id FROM prefix_content  ORDER BY `id` DESC "));	$post_id = $row['id'];//content id		//add cat	global $prefix_catmeta;	if(is_exists_cat($the_cat)){		borno_query("INSERT INTO $prefix_catmeta (`post_id`, `cat_id`) VALUES ('$post_id', '$the_cat')");	}	else{		borno_query("INSERT INTO $prefix_catmeta (`post_id`, `cat_id`) VALUES ('$post_id', '1');");	}	//adding permalink meta	borno_query("INSERT INTO prefix_cpermalink (`id`, `post_id`, `permalink`) VALUES (NULL, '$post_id', '$cpermalink');");		return $post_id;}function edit_post($post_id,$title ,$content , $newtitle , $newcontent,$post_status,$level,$password,$comment_permission ,$edited,$user_id,$cat_id,$cpermalink=''){	global $prefix_contents ;			$title = mysqli_escape($title);			$newtitle = htmlspecialchars($newtitle);			$content = mysqli_escape($content);			$newtitle = mysqli_escape($newtitle);			$newcontent = mysqli_escape($newcontent);			$newcontent = ($newcontent);			$password = mysqli_escape($password);			$post_id = mysqli_escape($post_id);			$cat_id = mysqli_escape($cat_id);			$post_status= mysqli_escape($post_status);			$comment_permission= mysqli_escape($comment_permission);			$edited= mysqli_escape($edited);			$user_id= mysqli_escape($user_id);											/*		*	Decide the new peramilijhnk		*		*/					/*			*	check the permalink is empty or not			*/						if(empty($cpermalink)){				$cpermalink  = 'random';			}else if(!validate_username($cpermalink)){				$cpermalink  = 'random';			}				if( content_permalink($post_id) != $cpermalink ){				$i=1;				$ppb = $cpermalink;				while(true){					if(!is_exists_cpermalink($cpermalink)){											break 1; 											}else{						$i++ ; 						$cpermalink = $ppb."_$i";										}				}		}				$cpermalink = mysqli_escape($cpermalink);		///we are successfullt ger $cpermalink		if(content_permalink($post_id)){		borno_query("UPDATE prefix_cpermalink SET `permalink` = '$cpermalink' WHERE `post_id` = $post_id; ");		}else{			borno_query("INSERT INTO prefix_cpermalink (`id`, `post_id`, `permalink`) VALUES (NULL, '$post_id', '$cpermalink');");		}																										//editeed	borno_query("UPDATE $prefix_contents SET title= '$newtitle' ,	`content` = '$newcontent',	`post_status` = '$post_status',	`post_level` = '$level',	`post_password` = '$password',	`comment_permission` = '$comment_permission',	`edited` = '$edited'	 WHERE id = '$post_id'");	 	 //ad a info to meta 	 global $prefix_contentmeta;	 $browser_info = $_SERVER['HTTP_USER_AGENT'];//browser info	$ip  = $_SERVER['REMOTE_ADDR'];// ip	$ip  = get_IP();// ip	///////////////////////////////////	///add revision	$revison_allow = get_the_option('post_revision');	if($revison_allow=='true'){	 $sql = "INSERT INTO $prefix_contentmeta ( `name`, `user_id`, `post_id`, `previous_title`, `previous_content`, `browser_info`, `ip`) VALUES ( 'reviceinfo', '$user_id', '$post_id', '$title', '$content', '$browser_info', '$ip')";		borno_query($sql);	}else{			///////////////revision not added 	}			////////////////////	////////////////////////////////////////////////cat function 	if(is_exists_cat($cat_id)){$cat=$cat_id;}else{$cat=1;}//cat id	global $prefix_catmeta;	/////cat update or delete 	$query = borno_query("SELECT * FROM $prefix_catmeta WHERE post_id='$post_id'");	$count = mysqli_num_rows($query);		if($count==0){			borno_query("INSERT INTO $prefix_catmeta (`post_id`, `cat_id`) VALUES ('$post_id', '$cat')");		}		else if($count==1){			borno_query("UPDATE $prefix_catmeta SET `cat_id` = '$cat' WHERE post_id =$post_id;");		}		else{			borno_query("DELETE FROM  $prefix_catmeta WHERE post_id = $post_id");			borno_query("INSERT INTO $prefix_catmeta (`post_id`, `cat_id`) VALUES ('$post_id', '$cat')");		}	 }